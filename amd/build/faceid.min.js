define("quizaccess_faceid/faceid",["jquery"],(function($){var config={};function resetVerification(){$("#start-faceid").prop("disabled",!1),$("#capture-face").remove();var hiddenField=$('input[name="faceidverified"]');hiddenField.val("0"),hiddenField.prop("value","0"),hiddenField.attr("value","0")}return{init:function(params){config=params,$(document).ready((function(){!function(){var startButton=$("#start-faceid");if(0===startButton.length)return;startButton.on("click",(function(){!function(){var video=document.getElementById("faceid-video"),message=$("#faceid-message"),startButton=$("#start-faceid");message.html('<span class="text-info">'+config.strings.starting_camera+"</span>"),startButton.prop("disabled",!0),navigator.mediaDevices.getUserMedia({video:{width:320,height:240,facingMode:"user"}}).then((function(stream){video.srcObject=stream,video.style.display="block",message.html('<span class="text-success">'+config.strings.camera_activated+"</span>"),setTimeout((function(){!function(stream){var message=$("#faceid-message"),captureBtn=$('<button type="button" class="btn btn-success ml-2" id="capture-face">'+config.strings.capture_face+"</button>");message.after(captureBtn),captureBtn.on("click",(function(){!function(stream){var video=document.getElementById("faceid-video"),canvas=document.createElement("canvas"),context=canvas.getContext("2d"),message=$("#faceid-message");canvas.width=video.videoWidth,canvas.height=video.videoHeight,context.drawImage(video,0,0),canvas.toBlob((function(blob){stream.getTracks().forEach((function(track){track.stop()})),video.style.display="none",message.html('<span class="text-info">'+config.strings.processing_image+"</span>"),$("#capture-face").prop("disabled",!0),function(imageBlob){var message=$("#faceid-message");if(!(config&&config.endpoint&&config.userid&&config.quizid&&config.wwwroot))return void message.html('<span class="text-danger">'+config.strings.incomplete_configuration+"</span>");var formData=new FormData;formData.append("image",imageBlob,"face.jpg"),formData.append("userid",config.userid),formData.append("quizid",config.quizid),formData.append("wwwroot",config.wwwroot),config.idnumber&&formData.append("idnumber",config.idnumber);$.ajax({url:config.endpoint,type:"POST",data:formData,processData:!1,contentType:!1,timeout:1e3*(config.timeout||10),success:function(response){!function(response){var message=$("#faceid-message"),hiddenField=$('input[name="faceidverified"]');try{var result="string"==typeof response?JSON.parse(response):response;if(result.success&&result.verified)hiddenField.val("1"),hiddenField.prop("value","1"),hiddenField.attr("value","1"),hiddenField.trigger("change"),message.html('<span class="text-success"><i class="fa fa-check-circle"></i> '+config.strings.verification_successful_continue+"</span>");else{var errorMsg=result.message||config.strings.could_not_verify_identity;message.html('<span class="text-danger"><i class="fa fa-times-circle"></i> '+errorMsg+"</span>"),resetVerification()}}catch(e){message.html('<span class="text-danger">'+config.strings.error_processing_response+"</span>"),resetVerification()}}(response)},error:function(xhr,status,error){message.html('<span class="text-danger">'+config.strings.error_verification+error+"</span>"),resetVerification()}})}(blob)}),"image/jpeg",.8)}(stream)}))}(stream)}),2e3)})).catch((function(error){message.html('<span class="text-danger">'+config.strings.error_camera_access+error.message+"</span>"),startButton.prop("disabled",!1)}))}()}))}()}))}}}));

//# sourceMappingURL=faceid.min.js.map